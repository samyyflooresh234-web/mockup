<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mockup Boletos</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f2;
}

.controls {
  padding: 16px;
  background: #fff;
}

label {
  display: block;
  margin-top: 14px;
  font-weight: 600;
}

input[type=range] {
  width: 100%;
}

button {
  margin-top: 16px;
  width: 100%;
  padding: 14px;
  font-size: 16px;
  background: #000;
  color: #fff;
  border: none;
  border-radius: 10px;
}

#canvasWrapper {
  display: flex;
  justify-content: center;
  padding: 20px;
}

#canvas {
  position: relative;
  overflow: hidden;
  background: #ddd;
  border-radius: 24px;
}

/* FORMATOS */
.square { width: 360px; height: 360px; }
.story { width: 360px; height: 640px; }
.wide { width: 360px; height: 114px; }

/* FONDO */
#bg {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  transform: scale(1.05);
}

/* BOLETOS */
.ticket {
  position: absolute;
  left: 50%;
  width: 82%;
  aspect-ratio: 3.2 / 1;
  transform-origin: center;
  border-radius: 14px;
  background-size: cover;
  background-position: center;
  box-shadow: 0 18px 35px rgba(0,0,0,.28);
}

/* CENTRADO VERTICAL BASE */
.ticket[data-i="0"] { top: 38%; }
.ticket[data-i="1"] { top: 44%; }
.ticket[data-i="2"] { top: 50%; }
.ticket[data-i="3"] { top: 56%; }
.ticket[data-i="4"] { top: 62%; }

</style>
</head>

<body>

<div class="controls">

<label>Formato</label>
<select id="format">
  <option value="square">1:1</option>
  <option value="story">Historia Instagram</option>
  <option value="wide">19:6</option>
</select>

<label>Fondo</label>
<input type="file" id="bgInput" accept="image/*"/>

<label>Opacidad fondo</label>
<input type="range" min="0.3" max="1" step="0.01" value="1" id="bgOpacity"/>

<label>Blur fondo</label>
<input type="range" min="0" max="20" value="0" id="bgBlur"/>

<label>Boletos (m√°x 5)</label>
<input type="file" id="ticketsInput" accept="image/*" multiple/>

<div id="sliders"></div>

<button onclick="exportImage()">Exportar imagen</button>

</div>

<div id="canvasWrapper">
  <div id="canvas" class="square">
    <div id="bg"></div>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const bg = document.getElementById("bg");
const sliders = document.getElementById("sliders");

const rotations = [-6, -3, 0, 3, 6];
let tickets = [];

document.getElementById("format").onchange = e => {
  canvas.className = e.target.value;
};

document.getElementById("bgInput").onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  bg.style.backgroundImage = `url(${URL.createObjectURL(file)})`;
};

document.getElementById("bgOpacity").oninput = e => {
  bg.style.opacity = e.target.value;
};

document.getElementById("bgBlur").oninput = e => {
  bg.style.filter = `blur(${e.target.value}px)`;
};

document.getElementById("ticketsInput").onchange = e => {
  tickets.forEach(t => t.remove());
  tickets = [];
  sliders.innerHTML = "";

  [...e.target.files].slice(0,5).forEach((file, i) => {
    const div = document.createElement("div");
    div.className = "ticket";
    div.dataset.i = i;
    div.style.backgroundImage = `url(${URL.createObjectURL(file)})`;
    div.style.transform = `translateX(-50%) rotate(${rotations[i]}deg)`;
    canvas.appendChild(div);
    tickets.push(div);

    const label = document.createElement("label");
    label.textContent = `Boleto ${i+1} (X)`;

    const range = document.createElement("input");
    range.type = "range";
    range.min = -120;
    range.max = 120;
    range.value = 0;
    range.oninput = ev => {
      div.style.transform =
        `translateX(calc(-50% + ${ev.target.value}px)) rotate(${rotations[i]}deg)`;
    };

    sliders.appendChild(label);
    sliders.appendChild(range);
  });
};

function exportImage() {
  html2canvas(canvas, { scale: 3 }).then(c => {
    const link = document.createElement("a");
    link.href = c.toDataURL("image/png");
    link.download = "mockup.png";
    link.click();
  });
}
</script>

</body>
</html>
